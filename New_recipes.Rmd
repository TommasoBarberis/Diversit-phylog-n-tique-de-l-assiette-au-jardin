---
title: "New recipes analysis"
output: html_document
---
## import libraries
```{r setup, include=FALSE}
library(naniar)
library(tidyr)
library(dplyr)
```

# collect data
```{r}
dta_vege <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Vegetarian/vegetarian_results.tsv", header=TRUE, sep="\t", fill=T)
summary(dta_vege)

dta_top <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Top/top_results.tsv", header=TRUE, sep="\t", fill=T)
summary(dta_top)

dta_dessert <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Dessert/dessert_results.tsv", header=TRUE, sep="\t", fill=T)
summary(dta_dessert)

dta_ratatouille <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Ratatouille/Ratatouille.tsv", header=TRUE, sep="\t")
```

## removing "g" from "Matière_sèche" column
```{r}
remove_grams <- function (d) {
  d$Matière_sèche <- as.numeric(sapply(d$Matière_sèche, sub, pattern=" g", replacement=""))
  return(d)
}
dta_vege<-remove_grams(dta_vege)
dta_top<-remove_grams(dta_top)
dta_dessert<-remove_grams(dta_dessert)
```

## grouping by recipe
```{r}
vege_by_recipe <- dta_vege %>% group_by(Recette)
top_by_recipe <- dta_top %>% group_by(Recette)
dessert_by_recipe <- dta_dessert %>% group_by(Recette)

summarise_by_mean <- function (d) {
  return( d %>% summarise(
    Eau = weighted.mean(x=Eau, w=Matière_sèche, na.rm = T), 
    Glucides = weighted.mean(x=Glucides, w=Matière_sèche, na.rm = T),
    Lipides = weighted.mean(x=Lipides, w=Matière_sèche, na.rm = T),
    Protéines = weighted.mean(x=Protéines, w=Matière_sèche, na.rm = T),
    Diversité.phylogénétique = mean(Diversité.phylogénétique, w=Matière_sèche, na.rm = T),
    Diversité.phylogénétique.pondérée = mean(Diversité.phylogénétique.pondérée, w=Matière_sèche, na.rm = T)
  )
  )
}

vege_simple <- summarise_by_mean(vege_by_recipe)
top_simple <- summarise_by_mean(top_by_recipe)
dessert_simple <- summarise_by_mean(dessert_by_recipe)
```

### By phylogenetic diversity
```{r}
par(mfrow=c(3,1), mar=c(4,3,0,0))
hist(vege_simple$Diversité.phylogénétique, ylim=c(0, 15), xlim=c(50, 350), main="", xlab="Vegetarian", col=rgb(0,1,0,0.3))
hist(top_simple$Diversité.phylogénétique, col=rgb(1, 0, 0, 0.3), ylim=c(0, 15), xlim=c(50, 350), main="", xlab="Top")
hist(dessert_simple$Diversité.phylogénétique, col=rgb(0, 0, 1, 0.3), ylim=c(0, 15), xlim=c(50, 350), main="", xlab="Desserts")
```

### By weighted phylogenetic diversity
```{r}
par(mfrow=c(3,1), mar=c(4,3,0,0))
hist(vege_simple$Diversité.phylogénétique.pondérée, ylim=c(0, 15), xlim=c(0, 60), main="", xlab="Vegetarian", col=rgb(0,1,0,0.3))
hist(top_simple$Diversité.phylogénétique.pondérée, col=rgb(1, 0, 0, 0.3), ylim=c(0, 15), xlim=c(0, 60), main="", xlab="Top")
hist(dessert_simple$Diversité.phylogénétique.pondérée, col=rgb(0, 0, 1, 0.3), ylim=c(0, 15), xlim=c(0, 60), main="", xlab="Desserts")
```

### Boxplot
```{r}
par(mfrow=c(1,1), mar=c(4,3,0,0))
boxplot(vege_simple$Diversité.phylogénétique.pondérée, top_simple$Diversité.phylogénétique.pondérée, dessert_simple$Diversité.phylogénétique.pondérée, col=c("green", "red", "blue"), names=c("Vegetarien", "top", "dessert"))
```

## Combining recipes
```{r}
all_simple <- rbind(vege_simple, top_simple, dessert_simple)
```

### Plot wheighted phylogenetic diversity by nutritional values
```{r}
par(mfrow=c(3,1), mar=c(4,3,0,0))
plot(all_simple$Glucides, all_simple$Diversité.phylogénétique.pondérée, pch=20, col=rgb(0,0,0, 0.3), ylab="Diversité phylogénétique pondérée", main="", xlab="Glucides")
abline(lm(all_simple$Diversité.phylogénétique.pondérée ~ all_simple$Glucides), lty=2, col="grey")
plot(all_simple$Lipides, all_simple$Diversité.phylogénétique.pondérée, pch=20, col=rgb(0,0,0, 0.3), ylab="Diversité phylogénétique pondérée", main="", xlab="Lipides")
abline(lm(all_simple$Diversité.phylogénétique.pondérée ~ all_simple$Lipides), lty=2, col="grey")
plot(all_simple$Protéines, all_simple$Diversité.phylogénétique.pondérée, pch=20, col=rgb(0,0,0, 0.3), ylab="Diversité phylogénétique pondérée", main="", xlab="Protéines")
abline(lm(all_simple$Diversité.phylogénétique.pondérée ~ all_simple$Protéines), lty=2, col="grey")
```

### Correlation with sugars
```{r}
cor.test(all_simple$Glucides, all_simple$Diversité.phylogénétique)
cor.test(all_simple$Glucides, all_simple$Diversité.phylogénétique.pondérée)
```

### Correlation with lipides
```{r}
cor.test(all_simple$Lipides, all_simple$Diversité.phylogénétique)
cor.test(all_simple$Lipides, all_simple$Diversité.phylogénétique.pondérée)
```

### Correlation with proteins
```{r}
cor.test(all_simple$Protéines, all_simple$Diversité.phylogénétique)
cor.test(all_simple$Protéines, all_simple$Diversité.phylogénétique.pondérée)
```

## Linear model: can we explain phylogenetic diversity based on composition?
```{r}
linear_model <- lm(Diversité.phylogénétique ~ Glucides + Protéines + Lipides, data=all_simple)
summary(linear_model)
```

```{r}
linear_model.p <- lm(Diversité.phylogénétique.pondérée ~ Glucides + Protéines + Lipides, data=all_simple)
summary(linear_model.p)
```

