---
title: "New recipes analysis"
Author: "Tommaso"
output: 
  keep_md: true
---

# Import libraries
```{r}
library(naniar)
library(tidyr)
library(dplyr)
```

# Collect data
```{r results='markup'}
dta_vege <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Vegetarian/vegetarian_results.tsv", header=TRUE, sep="\t", fill=T)
summary(dta_vege)
```
                                                           Recette            Ingrédient 
 Tourte de Noël végétarienne de Coralie                        : 17   Poivre       : 21  
 Burger végétarien aux lentilles                               : 15   Oignon       : 19  
 Ragoût végétarien aux légumes                                 : 15   Sel          : 19  
 Tarte provençale fine, light, végétarienne, économique, rapide: 15   Huile d'olive: 13  
 Couscous végétarien facile                                    : 14   Oeuf         : 13  
 Paëlla végétarienne                                           : 14   Ail          : 12  
 (Other)                                                       :244   (Other)      :237  
                  Espèce       Quantité   Matière_sèche      Eau           Glucides    
 Piper nigrum        : 27   1 g    : 43   0.91 g : 21   Min.   : 0.00   Min.   : 0.00  
 Allium cepa         : 20   30 g   : 27   1.0 g  : 19   1st Qu.: 9.00   1st Qu.: 2.25  
 Bos taurus          : 19   200 g  : 19   12.48 g: 11   Median :67.80   Median : 6.25  
 Gallus gallus       : 17   5 g    : 19   18.96 g:  7   Mean   :53.34   Mean   :15.64  
 Solanum lycopersicum: 17   120 g  : 18   29.97 g:  7   3rd Qu.:88.20   3rd Qu.:21.40  
 (Other)             :192   80 g   : 17   (Other):258   Max.   :98.00   Max.   :99.80  
 NA's                : 42   (Other):191   NA's   : 11   NA's   :10      NA's   :21     
    Lipides         Protéines      Diversité.phylogénétique Diversité.phylogénétique.pondérée
 Min.   :  0.00   Min.   : 0.000   Min.   : 72.0            Min.   :13.87                    
 1st Qu.:  0.36   1st Qu.: 1.060   1st Qu.:165.0            1st Qu.:17.85                    
 Median :  0.62   Median : 2.820   Median :202.8            Median :24.71                    
 Mean   : 13.37   Mean   : 5.368   Mean   :205.1            Mean   :24.61                    
 3rd Qu.:  9.83   3rd Qu.: 9.030   3rd Qu.:258.0            3rd Qu.:30.16                    
 Max.   :100.00   Max.   :31.100   Max.   :343.5            Max.   :36.55                    
 NA's   :9        NA's   :9                                                                  
 Indice.de.Shannon Indice.de.Simpson
 Min.   :-0.060    Min.   :0.1300   
 1st Qu.: 1.290    1st Qu.:0.4475   
 Median : 1.810    Median :1.1000   
 Mean   : 1.718    Mean   :1.5765   
 3rd Qu.: 2.245    3rd Qu.:2.5400   
 Max.   : 3.150    Max.   :5.9100   
                                    
                                                                                                       URL.de.la.recette
 https://www.marmiton.org/recettes/recette_tourte-de-noel-vegetarienne-de-coralie_15536.aspx                    : 17    
 https://www.marmiton.org/recettes/recette_burger-vegetarien-aux-lentilles_345408.aspx                          : 15    
 https://www.marmiton.org/recettes/recette_ragout-vegetarien-aux-legumes_65191.aspx                             : 15    
 https://www.marmiton.org/recettes/recette_tarte-provencale-fine-light-vegetarienne-economique-rapide_38642.aspx: 15    
 https://www.marmiton.org/recettes/recette_couscous-vegetarien-facile_62233.aspx                                : 14    
 https://www.marmiton.org/recettes/recette_paella-vegetarienne_47534.aspx                                       : 14    
 (Other)                                                                                                        :244    
 
```{r}

dta_top <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Top/top_results.tsv", header=TRUE, sep="\t", fill=T)
summary(dta_top)

dta_dessert <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Dessert/dessert_results.tsv", header=TRUE, sep="\t", fill=T)
summary(dta_dessert)

dta_ratatouille <- read.csv("/home/tommaso/diversite-phylogenetique-de-l-assiette-au-jardin/results/Ratatouille/Ratatouille.tsv", header=TRUE, sep="\t")
```


## removing "g" from "Matière_sèche" column
```{r}
remove_grams <- function (d) {
  d$Matière_sèche <- as.numeric(sapply(d$Matière_sèche, sub, pattern=" g", replacement=""))
  return(d)
}
dta_vege<-remove_grams(dta_vege)
dta_top<-remove_grams(dta_top)
dta_dessert<-remove_grams(dta_dessert)
```

## grouping by recipe
```{r}
vege_by_recipe <- dta_vege %>% group_by(Recette)
top_by_recipe <- dta_top %>% group_by(Recette)
dessert_by_recipe <- dta_dessert %>% group_by(Recette)

summarise_by_mean <- function (d) {
  return( d %>% summarise(
    Eau = weighted.mean(x=Eau, w=Matière_sèche, na.rm = T), 
    Glucides = weighted.mean(x=Glucides, w=Matière_sèche, na.rm = T),
    Lipides = weighted.mean(x=Lipides, w=Matière_sèche, na.rm = T),
    Protéines = weighted.mean(x=Protéines, w=Matière_sèche, na.rm = T),
    Diversité.phylogénétique = mean(Diversité.phylogénétique, w=Matière_sèche, na.rm = T),
    Diversité.phylogénétique.pondérée = mean(Diversité.phylogénétique.pondérée, w=Matière_sèche, na.rm = T)
  )
  )
}

vege_simple <- summarise_by_mean(vege_by_recipe)
top_simple <- summarise_by_mean(top_by_recipe)
dessert_simple <- summarise_by_mean(dessert_by_recipe)
```

### By phylogenetic diversity
```{r}
par(mfrow=c(3,1), mar=c(4,3,0,0))
hist(vege_simple$Diversité.phylogénétique, ylim=c(0, 15), xlim=c(50, 350), main="", xlab="Vegetarian", col=rgb(0,1,0,0.3))
hist(top_simple$Diversité.phylogénétique, col=rgb(1, 0, 0, 0.3), ylim=c(0, 15), xlim=c(50, 350), main="", xlab="Top")
hist(dessert_simple$Diversité.phylogénétique, col=rgb(0, 0, 1, 0.3), ylim=c(0, 15), xlim=c(50, 350), main="", xlab="Desserts")
```

### By weighted phylogenetic diversity
```{r}
par(mfrow=c(3,1), mar=c(4,3,0,0))
hist(vege_simple$Diversité.phylogénétique.pondérée, ylim=c(0, 15), xlim=c(0, 60), main="", xlab="Vegetarian", col=rgb(0,1,0,0.3))
hist(top_simple$Diversité.phylogénétique.pondérée, col=rgb(1, 0, 0, 0.3), ylim=c(0, 15), xlim=c(0, 60), main="", xlab="Top")
hist(dessert_simple$Diversité.phylogénétique.pondérée, col=rgb(0, 0, 1, 0.3), ylim=c(0, 15), xlim=c(0, 60), main="", xlab="Desserts")
```

### Boxplot
```{r}
par(mfrow=c(1,1), mar=c(4,3,0,0))
boxplot(vege_simple$Diversité.phylogénétique.pondérée, top_simple$Diversité.phylogénétique.pondérée, dessert_simple$Diversité.phylogénétique.pondérée, col=c("green", "red", "blue"), names=c("Vegetarien", "top", "dessert"))
```

## Combining recipes
```{r}
all_simple <- rbind(vege_simple, top_simple, dessert_simple)
```

### Plot wheighted phylogenetic diversity by nutritional values
```{r}
par(mfrow=c(3,1), mar=c(4,3,0,0))
plot(all_simple$Glucides, all_simple$Diversité.phylogénétique.pondérée, pch=20, col=rgb(0,0,0, 0.3), ylab="Diversité phylogénétique pondérée", main="", xlab="Glucides")
abline(lm(all_simple$Diversité.phylogénétique.pondérée ~ all_simple$Glucides), lty=2, col="grey")
plot(all_simple$Lipides, all_simple$Diversité.phylogénétique.pondérée, pch=20, col=rgb(0,0,0, 0.3), ylab="Diversité phylogénétique pondérée", main="", xlab="Lipides")
abline(lm(all_simple$Diversité.phylogénétique.pondérée ~ all_simple$Lipides), lty=2, col="grey")
plot(all_simple$Protéines, all_simple$Diversité.phylogénétique.pondérée, pch=20, col=rgb(0,0,0, 0.3), ylab="Diversité phylogénétique pondérée", main="", xlab="Protéines")
abline(lm(all_simple$Diversité.phylogénétique.pondérée ~ all_simple$Protéines), lty=2, col="grey")
```

### Correlation with sugars
```{r}
cor.test(all_simple$Glucides, all_simple$Diversité.phylogénétique)
cor.test(all_simple$Glucides, all_simple$Diversité.phylogénétique.pondérée)
```

### Correlation with lipides
```{r}
cor.test(all_simple$Lipides, all_simple$Diversité.phylogénétique)
cor.test(all_simple$Lipides, all_simple$Diversité.phylogénétique.pondérée)
```

### Correlation with proteins
```{r}
cor.test(all_simple$Protéines, all_simple$Diversité.phylogénétique)
cor.test(all_simple$Protéines, all_simple$Diversité.phylogénétique.pondérée)
```

## Linear model: can we explain phylogenetic diversity based on composition?
```{r}
linear_model <- lm(Diversité.phylogénétique ~ Glucides + Protéines + Lipides, data=all_simple)
summary(linear_model)
```

```{r}
linear_model.p <- lm(Diversité.phylogénétique.pondérée ~ Glucides + Protéines + Lipides, data=all_simple)
summary(linear_model.p)
```

